<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  ﻿<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />


﻿

  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ActiveMQ," />





  <link rel="alternate" href="/atom.xml" title="wjlfun.info" type="application/atom+xml" />






<meta name="description" content="&amp;lt;h1 class=&amp;quot;title&amp;quot;&amp;gt;消息队列之 ActiveMQ&amp;lt;/h1&amp;gt;     &amp;lt;!-- 文章内容 --&amp;gt; &amp;lt;div data-note-content=&amp;quot;&amp;quot; class=&amp;quot;show-content&amp;quot;&amp;gt;   &amp;lt;div class=&amp;quot;show-content-free&amp;q">
<meta name="keywords" content="ActiveMQ">
<meta property="og:type" content="article">
<meta property="og:title" content="消息队列之ActiveMQ">
<meta property="og:url" content="http://wjlfun.info/2016/01/16/消息队列之 ActiveMQ/index.html">
<meta property="og:site_name" content="wjlfun.info">
<meta property="og:description" content="&amp;lt;h1 class=&amp;quot;title&amp;quot;&amp;gt;消息队列之 ActiveMQ&amp;lt;/h1&amp;gt;     &amp;lt;!-- 文章内容 --&amp;gt; &amp;lt;div data-note-content=&amp;quot;&amp;quot; class=&amp;quot;show-content&amp;quot;&amp;gt;   &amp;lt;div class=&amp;quot;show-content-free&amp;q">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5015984-dd9724f8710231e5?imageMogr2/auto-orient/strip%7CimageView2/2/w/568">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5015984-bbf01f49ca5d8d4c?imageMogr2/auto-orient/strip%7CimageView2/2/w/700">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5015984-5ed76cf546927df2?imageMogr2/auto-orient/strip%7CimageView2/2/w/700">
<meta property="og:updated_time" content="2018-05-15T11:33:54.917Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="消息队列之ActiveMQ">
<meta name="twitter:description" content="&amp;lt;h1 class=&amp;quot;title&amp;quot;&amp;gt;消息队列之 ActiveMQ&amp;lt;/h1&amp;gt;     &amp;lt;!-- 文章内容 --&amp;gt; &amp;lt;div data-note-content=&amp;quot;&amp;quot; class=&amp;quot;show-content&amp;quot;&amp;gt;   &amp;lt;div class=&amp;quot;show-content-free&amp;q">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/5015984-dd9724f8710231e5?imageMogr2/auto-orient/strip%7CimageView2/2/w/568">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wjlfun.info/2016/01/16/消息队列之 ActiveMQ/"/>


﻿


 <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/7904c2d4.js","daovoice")</script>


 <script>
  daovoice('init', {
  app_id: "7904c2d4"
});
daovoice('update');
  </script>

  <title>消息队列之ActiveMQ | wjlfun.info</title>
  








</head>

<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<a href="https://github.com/you" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">﻿<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">wjlfun.info</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">云飞扬的个人博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tag"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wjlfun.info/2016/01/16/消息队列之 ActiveMQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吴金龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wjlfun.info">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">消息队列之ActiveMQ</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-16T00:00:00+08:00">
                2016-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o">浏览数</i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>98
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,149
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <script src="\assets\js\APlayer.min.js"> </script><pre><code>&lt;h1 class=&quot;title&quot;&gt;消息队列之 ActiveMQ&lt;/h1&gt;




&lt;!-- 文章内容 --&gt;
&lt;div data-note-content=&quot;&quot; class=&quot;show-content&quot;&gt;
  &lt;div class=&quot;show-content-free&quot;&gt;
</code></pre><p></p><h3>ActiveMQ 特点</h3><p></p>
<p>ActiveMQ 是由 Apache 出品的一款开源消息中间件，旨在为应用程序提供高效、可扩展、稳定、安全的企业级消息通信。<br><br>它的设计目标是提供标准的、面向消息的、多语言的应用集成消息通信中间件。ActiveMQ 实现了 JMS 1.1 并提供了很多附加的特性，比如 JMX 管理、主从管理、消息组通信、消息优先级、延迟接收消息、虚拟接收者、消息持久化、消息队列监控等等。其主要特性有：</p><br><ol><br><li>支持包括 Java、C、C++、C#、Ruby、Perl、Python、PHP 等多种语言的客户端和协议。协议包含 OpenWire、Stomp、AMQP、MQTT 。</li><br><li>提供了像消息组通信、消息优先级、延迟接收消息、虚拟接收者、消息持久化之类的高级特性</li><br><li>完全支持 JMS 1.1 和 J2EE 1.4规范（包括持久化、分布式事务消息、事务）</li><br><li>对 Spring 框架的支持，ActiveMQ 可以通过 Spring 的配置文件方式很容易嵌入到 Spring 应用中</li><br><li>通过了常见的 J2EE 服务器测试，比如 TomEE、Geronimo、JBoss、GlassFish、WebLogic</li><br><li>连接方式的多样化，ActiveMQ 提供了多种连接模式，例如 in-VM、TCP、SSL、NIO、UDP、多播、JGroups、JXTA</li><br><li>支持通过使用 JDBC 和 journal 实现消息的快速持久化</li><br><li>为高性能集群、客户端-服务器、点对点通信等场景而设计</li><br><li>提供了技术和语言中立的 REST API 接口</li><br><li>支持 Ajax 方式调用 ActiveMQ</li><br><li>ActiveMQ 可以轻松地与 CXF、Axis 等 Web Service 技术整合，以提供可靠的消息传递</li><br><li>可用作为内存中的 JMS 提供者，非常适合 JMS 单元测试</li><br></ol><br><h3>基本概念</h3><br><p>因为 ActiveMQ 是完整支持 JMS 1.1 的，所以从 Java 使用者的角度其基本概念与 JMS 1.1 规范是一致的。</p><br><h5>消息传送模型</h5><br><ol><br><li><p>点对点模型（Point to Point）<br><br>使用队列（Queue）作为消息通信载体，满足生产者与消费者模式，一条消息只能被一个消费者使用，未被消费的消息在队列中保留直到被消费或超时。</p></li><br><li><p>发布订阅模型（Pub/Sub）<br><br>使用主题作为消息通信载体，类似于广播模式，发布者发布一条消息，该消息通过主题传递给所有的订阅者，在一条消息广播之后才订阅的用户则是收不到该条消息的。</p></li><br></ol><br><h5>基本组件</h5><br><p>ActiveMQ 使用时包含的基本组件各与 JMS 是相同的：</p><br><ol><br><li>Broker，消息代理，表示消息队列服务器实体，接受客户端连接，提供消息通信的核心服务。</li><br><li>Producer，消息生产者，业务的发起方，负责生产消息并传输给 Broker 。</li><br><li>Consumer，消息消费者，业务的处理方，负责从 Broker 获取消息并进行业务逻辑处理。</li><br><li>Topic，主题，发布订阅模式下的消息统一汇集地，不同生产者向 Topic 发送消息，由 Broker 分发到不同的订阅者，实现消息的广播。</li><br><li>Queue，队列，点对点模式下特定生产者向特定队列发送消息，消费者订阅特定队列接收消息并进行业务逻辑处理。</li><br><li>Message，消息体，根据不同通信协议定义的固定格式进行编码的数据包，来封装业务 数据，实现消息的传输。</li><br></ol><br><p>由于这些概念在 JMS 中已介绍过，这里不再详细介绍。</p><br><h5>连接器</h5><br><p>ActiveMQ Broker 的主要作用是为客户端应用提供一种通信机制，为此 ActiveMQ 提供了一种连接机制，并用连接器（connector）来描述这种连接机制。ActiveMQ 中连接器有两种，一种是用于客户端与消息代理服务器（client-to-broker）之间通信的传输连接器（transport connector），一种是用于消息代理服务器之间（broker-to-broker）通信的网络连接器（network connector）。connector 使用 URI（统一资源定位符）来表示，URI 格式为：<br><br><code>&lt;schema name&gt;:&lt;hierarchical part&gt;[?&lt;query&gt;][#&lt;fragment&gt;]</code><br><br>schema name 表示协议，<br><br>例如：<a href="https://link.jianshu.com?t=foo%3A%2F%2Fusername%3Apassword%40example.com%3A8042%2Fover%2Fthere%2Findex.dtb%3Ftype%3Danimal%26name%3Dnarwhal%23nose" target="_blank" rel="nofollow">foo://username:password@example.com:8042/over/there/index.dtb?type=animal&amp;name=narwhal#nose</a></p><br><p>其中 schema name 部分是 foo，hierarchical part 是 <a href="https://link.jianshu.com?t=mailto%3Ausername%3Apassword%40example.com" target="_blank" rel="nofollow">username:password@example.com</a>:8042/over/there/index.dtb，query 是 type=animal&amp;name=narwhal，fragment 是 nose。</p><br><ol><br><li>传输连接器<br><br>为了交换消息，消息生产者和消息消费者（统称为客户端）都需要连接到消息代理服务器，这种客户端和消息代理服务器之间的通信就是通过传输连接器（Transport connectors）完成的。很多情况下用户连接消息代理时的需求侧重点不同，有的更关注性能，有的更注重安全性，因此 ActiveMQ 提供了一系列l连接协议供选择，来覆盖这些使用场景。从消息代理的角度看，传输连接器就是用来处理和监听客户端连接的，查看 ActiveMQ demo 的配置文件（/examples/conf/activemq-demo.xml），传输连接的相关配置如下：</li><br></ol><br><pre class="hljs xml"><code class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">transportConnectors</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transportConnector</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“openwire”</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">“tcp://localhost:61616”</span> <span class="hljs-attr">discoveryUri</span>=<span class="hljs-string">“multicast://default”</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transportConnector</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“ssl”</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">“ssl://localhost:61617”</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transportConnector</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“stomp”</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">“stomp://localhost:61613”</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transportConnector</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“ws”</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">“ws://localhost:61614/“</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">transportConnectors</span>&gt;</span><br></code></pre><br><p>传输连接器定义在<code>&lt;transportConnectors&gt;</code>元素中，一个<code>&lt;transportConnector&gt;</code>元素定义一个特定的连接器，一个连接器必须有自己唯一的名字和 URI 属性，但<code>discoveryUri</code>属性是可选的。目前在 ActiveMQ 最新的5.15版本中常用的传输连接器连接协议有：vm、tcp、udp、multicast、nio、ssl、http、https、websocket、amqp、mqtt、stomp 等等</p><br><ul><br><li>vm，允许客户端和消息服务器直接在 VM 内部通信，采用的连接不是 Socket 连接，而是直接的虚拟机本地方法调用，从而避免网络传输的开销。应用场景仅限于服务器和客户端在同一 JVM 中。</li><br><li>tcp，客户端通过 TCP 连接到远程的消息服务器。</li><br><li>udp，客户端通过 UDP 连接到远程的消息服务器。</li><br><li>multicast，允许使用组播传输的方式连接到消息服务器。</li><br><li>nio，nio 和 tcp 的作用是一样的，只不过 nio 使用了 java 的 NIO包，这可能在某些场景下可提供更好的性能。</li><br><li>ssl，ssl 允许用户在 TCP 的基础上使用 SSL 。</li><br><li>http 和 https，允许客户端使用 REST 或 Ajax 的方式进行连接，这意味着可以直接使用 Javascript 向 ActiveMQ 发送消息。</li><br><li>websocket，允许客户端通过 HTML5 中的 WebSocket 方式连接到消息服务器。</li><br><li>amqp，5.8版本开始支持。</li><br><li>mqtt、stomp，5.6版本开始支持。</li><br></ul><br><p>每个协议的具体配置见官网（<a href="https://link.jianshu.com?t=http%3A%2F%2Factivemq.apache.org%2Furi-protocols.html" target="_blank" rel="nofollow">http://activemq.apache.org/uri-protocols.html</a> ）。除了以上这些基本协议之外 ActiveMQ 还支持一些高级协议也可以通过 URI 的方式进行配置，比如 Failover 和 Fanout 。</p><br><ul><br><li>Failover 是一种重新连接的机制，工作于上面介绍的连接协议的上层，用于建立可靠的传输。其配置语法允许制定任意多个复合的 URI ，它会自动选择其中的一个 URI 来尝试建立连接，如果该连接没有成功，则会继续选择其它的 URI 来尝试。配置语法例如：failover:(<a href="https://link.jianshu.com?t=tcp%3A%2F%2Flocalhost%3A61616%2Ctcp%3A%2F%2Fremotehost%3A61616%29%3FinitialReconnectDelay%3D100" target="_blank" rel="nofollow">tcp://localhost:61616,tcp://remotehost:61616)?initialReconnectDelay=100</a><br></li><br><li>Fanout 是一种重新连接和复制的机制，它也工作于其它连接的上层，采用复制的方式把消息复制到多个消息服务器。配置语法例如：fanout:(<a href="https://link.jianshu.com?t=tcp%3A%2F%2Flocalhost%3A61629%2Ctcp%3A%2F%2Flocalhost%3A61639%2Ctcp%3A%2F%2Flocalhost%3A61649" target="_blank" rel="nofollow">tcp://localhost:61629,tcp://localhost:61639,tcp://localhost:61649</a>)</li><br></ul><br><ol start="2"><br><li>网络连接器<br><br>很多情况下，我们要处理的数据可能是海量的，这种场景单台服务器很难支撑，这就要用到集群功能，为此 ActiveMQ 提供了网络连接的模式，简单说就是通过把多个消息服务器实例连接在一起作为一个整体对外提供服务，从而提高整体对外的消息服务能力。通过这种方式连接在一起的服务器实例之间可共享队列和消费者列表，从而达到分布式队列的目的，网络连接器就是用来配置服务器之间的通信。</li><br></ol><br><div class="image-package"><br><div class="image-container" style="max-width: 568px; max-height: 552px; background-color: transparent;"><br><div class="image-container-fill" style="padding-bottom: 97.18%;"></div><br><div class="image-view" data-width="568" data-height="552"><img data-original-src="//upload-images.jianshu.io/upload_images/5015984-dd9724f8710231e5" data-original-width="568" data-original-height="552" data-original-format="image/png" data-original-filesize="38430" style="cursor: zoom-in;" class="" src="//upload-images.jianshu.io/upload_images/5015984-dd9724f8710231e5?imageMogr2/auto-orient/strip%7CimageView2/2/w/568"></div><br></div><br><div class="image-caption">使用网络连接器的简单场景</div><br></div><p>)</p>

<p>如图所示，服务器 S1 和 S2 通过 NewworkConnector 相连，生产者 P1 发送的消息，消费者 C3 和 C4 都可以接收到，而生产者 P3 发送的消息，消费者 C1 和 C2 也可以接收到。要使用网络连接器的功能需要在服务器 S1 的 activemq.xml 中的 broker 节点下添加如下配置（假设192.168.11.23:61617 为 S2 的地址）：</p><br><pre class="hljs javascript"><code class="javascript">&lt;networkConnectors&gt;<br>          <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">networkConnector</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">“static:(tcp://192.168.11.23:61617)”</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">networkConnectors</span>&gt;</span></span><br></code></pre><br><p>如果只是这样，S1 可以将消息发送到 S2，但这只是单方向的通信，发送到 S2 上的的消息还不能发送到 S1 上。如果想 S1 也收到从 S2 发来的消息需要在 S2 的 activemq.xml 中的 broker 节点下也添加如下配置（假设192.168.11.45:61617为 S1 的地址）：</p><br><pre class="hljs javascript"><code class="javascript">&lt;networkConnectors&gt;<br>          <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">networkConnector</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">“static:(tcp://192.168.11.45:61617)”</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">networkConnectors</span>&gt;</span></span><br></code></pre><br><p>这样，S1和S2就可以双向通信了。目前在 ActiveMQ 最新的5.15版本中常用的网络连接器协议有 static 和 multicast 两种。</p><br><ul><br><li>static，静态协议，用于为一个网络中多个代理创建静态配置，这种配置协议支持复合的 URI （即包含其他 URI 的 URI）。例如<code>static://(tcp://ip:61616,tcp://ip2:61616)</code><br></li><br><li>multicast，多点传送协议，消息服务器会广播自己的服务，也会定位其他代理。这种方式用于服务器之间实现动态识别，而不是配置静态的 IP 组。</li><br></ul><br><p>对这块感兴趣的话可以看官方文档：<a href="https://link.jianshu.com?t=http%3A%2F%2Factivemq.apache.org%2Fnetworks-of-brokers.html" target="_blank" rel="nofollow">http://activemq.apache.org/networks-of-brokers.html</a></p><br><h5>消息存储</h5><br><p>JMS 规范中消息的分发方式有两种：非持久化和持久化。对于非持久化消息 JMS 实现者须保证尽最大努力分发消息，但消息不会持久化存储；而持久化方式分发的消息则必须进行持久化存储。非持久化消息常用于发送通知或实时数据，当你比较看重系统性能并且即使丢失一些消息并不影响业务正常运作时可选择非持久化消息。持久化消息被发送到消息服务器后如果当前消息的消费者并没有运行则该消息继续存在，只有等到消息被处理并被消息消费者确认之后，消息才会从消息服务器中删除。</p><br><p>对以上这两种方式 ActiveMQ 都支持，并且还支持通过缓存在内存中的中间状态消息的方式来恢复消息。概括起来看 ActiveMQ 的消息存储有三种：存储到内存、存储到文件、存储到数据库。具体使用上 ActiveMQ 提供了一个插件式的消息存储机制，类似于消息的多点传播，主要实现了如下几种：</p><br><ul><br><li>AMQ，是 ActiveMQ 5.0及以前版本默认的消息存储方式，它是一个基于文件的、支持事务的消息存储解决方案。<br><br>在此方案下消息本身以日志的形式实现持久化，存放在 Data Log 里。并且还对日志里的消息做了引用索引，方便快速取回消息。</li><br><li>KahaDB，也是一种基于文件并具有支持事务的消息存储方式，从5.3开始推荐使用 KahaDB 存储消息，它提供了比 AMQ 消息存储更好的可扩展性和可恢复性。</li><br><li>JDBC，基于 JDBC 方式将消息存储在数据库中，将消息存到数据库相对来说比较慢，所以 ActiveMQ 建议结合 journal 来存储，它使用了快速的缓存写入技术，大大提高了性能。</li><br><li>内存存储，是指将所有要持久化的消息放到内存中，因为这里没有动态的缓存，所以需要注意设置消息服务器的 JVM 和内存大小。</li><br><li>LevelDB，5.6版本之后推出了 LevelDB 的持久化引擎，它使用了自定义的索引代替常用的 BTree 索引，其持久化性能高于 KahaDB，虽然默认的持久化方式还是 KahaDB，但是 LevelDB 将是趋势。在5.9版本还提供了基于 LevelDB 和 Zookeeper 的数据复制方式，作为 Master-Slave 方式的首选数据复制方案。</li><br></ul><br><h1>工程实例</h1><br><h3>Java 访问 ActiveMQ 实例</h3><br><p>在 JMS 规范中传递消息的方式有两种，一种是点对点模型的队列（Queue）方式，另一种是发布订阅模型的主题（Topic）方式。下面看下用 ActiveMQ 以主题方式传递消息的 Java 示例。</p><br><h5>引入依赖</h5><br><p>Java 工程中需要引入 ActiveMQ 包的依赖，jar 包版本同你安装 ActiveMQ 版本一致即可：</p><br><pre class="hljs xml"><code class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.activemq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>activemq-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.15.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre><br><h5>消息生产者</h5><br><pre class="hljs java"><code class="java"><span class="hljs-keyword">package</span> org.study.mq.activeMQ;<br><br><span class="hljs-keyword">import</span> org.apache.activemq.ActiveMQConnection;<br><span class="hljs-keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;<br><br><span class="hljs-keyword">import</span> javax.jms.<em>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TopicPublisher</span> </span>{<br><br>    <span class="hljs-comment">/**
     </span></em> 默认用户名<br>     <em>/<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USERNAME = ActiveMQConnection.DEFAULT_USER;<br>    <span class="hljs-comment">/**
     </span></em> 默认密码<br>     <em>/<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = ActiveMQConnection.DEFAULT_PASSWORD;<br>    <span class="hljs-comment">/**
     </span></em> 默认连接地址<br>     <em>/<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String BROKER_URL = ActiveMQConnection.DEFAULT_BROKER_URL;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        <span class="hljs-comment">//创建连接工厂</span><br>        ConnectionFactory connectionFactory = <span class="hljs-keyword">new</span> ActiveMQConnectionFactory(USERNAME, PASSWORD, BROKER_URL);<br>        <span class="hljs-keyword">try</span> {<br>            <span class="hljs-comment">//创建连接</span><br>            Connection connection = connectionFactory.createConnection();<br>            <span class="hljs-comment">//开启连接</span><br>            connection.start();<br>            <span class="hljs-comment">//创建会话，不需要事务</span><br>            Session session = connection.createSession(<span class="hljs-keyword">false</span>, Session.AUTO_ACKNOWLEDGE);<br>            <span class="hljs-comment">//创建 Topic，用作消费者订阅消息</span><br>            Topic myTestTopic = session.createTopic(<span class="hljs-string">“activemq-topic-test1”</span>);<br>            <span class="hljs-comment">//消息生产者</span><br>            MessageProducer producer = session.createProducer(myTestTopic);<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++) {<br>                TextMessage message = session.createTextMessage(<span class="hljs-string">“发送消息 “</span> + i);<br>                producer.send(myTestTopic, message);<br>            }<br><br>            <span class="hljs-comment">//关闭资源</span><br>            session.close();<br>            connection.close();<br>        } <span class="hljs-keyword">catch</span> (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br>}<br></em></code></pre><br><p>在 Topic 模式中消息生产者是用于发布消息的，绝大部分代码与 Queue 模式中相似，不同的是本例中基于 Session 创建的是主题（Topic），该主题作为消费者消费消息的目的地。</p><br><h5>消息消费者</h5><br><pre class="hljs java"><code class="java"><span class="hljs-keyword">package</span> org.study.mq.activeMQ;<br><br><span class="hljs-keyword">import</span> org.apache.activemq.ActiveMQConnection;<br><span class="hljs-keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;<br><br><span class="hljs-keyword">import</span> javax.jms.;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TopicSubscriber</span> </span>{<br><br>    <span class="hljs-comment">/<strong><br>     <em> 默认用户名
     </em>/</strong></span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USERNAME = ActiveMQConnection.DEFAULT_USER;<br>    <span class="hljs-comment">/<br>     <em> 默认密码
     </em>/</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = ActiveMQConnection.DEFAULT_PASSWORD;<br>    <span class="hljs-comment">/<em>*
     </em> 默认连接地址<br>     <em>/</em></span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String BROKER_URL = ActiveMQConnection.DEFAULT_BROKER_URL;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        <span class="hljs-comment">//创建连接工厂</span><br>        ConnectionFactory connectionFactory = <span class="hljs-keyword">new</span> ActiveMQConnectionFactory(USERNAME, PASSWORD, BROKER_URL);<br>        <span class="hljs-keyword">try</span> {<br>            <span class="hljs-comment">//创建连接</span><br>            Connection connection = connectionFactory.createConnection();<br>            <span class="hljs-comment">//开启连接</span><br>            connection.start();<br>            <span class="hljs-comment">//创建会话，不需要事务</span><br>            Session session = connection.createSession(<span class="hljs-keyword">false</span>, Session.AUTO_ACKNOWLEDGE);<br>            <span class="hljs-comment">//创建 Topic</span><br>            Topic myTestTopic = session.createTopic(<span class="hljs-string">“activemq-topic-test1”</span>);<br><br>            MessageConsumer messageConsumer = session.createConsumer(myTestTopic);<br>            messageConsumer.setMessageListener(<span class="hljs-keyword">new</span> MessageListener() {<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(Message message)</span> </span>{<br>                    <span class="hljs-keyword">try</span> {<br>                        System.out.println(<span class="hljs-string">“消费者1 接收到消息：”</span> + ((TextMessage) message).getText());<br>                    } <span class="hljs-keyword">catch</span> (JMSException e) {<br>                        e.printStackTrace();<br>                    }<br>                }<br>            });<br><br>            MessageConsumer messageConsumer2 = session.createConsumer(myTestTopic);<br>            messageConsumer2.setMessageListener(<span class="hljs-keyword">new</span> MessageListener() {<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(Message message)</span> </span>{<br>                    <span class="hljs-keyword">try</span> {<br>                        System.out.println(<span class="hljs-string">“消费者2 接收到消息：”</span> + ((TextMessage) message).getText());<br>                    } <span class="hljs-keyword">catch</span> (JMSException e) {<br>                        e.printStackTrace();<br>                    }<br>                }<br>            });<br><br>            MessageConsumer messageConsumer3 = session.createConsumer(myTestTopic);<br>            messageConsumer3.setMessageListener(<span class="hljs-keyword">new</span> MessageListener() {<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(Message message)</span> </span>{<br>                    <span class="hljs-keyword">try</span> {<br>                        System.out.println(<span class="hljs-string">“消费者3 接收到消息：”</span> + ((TextMessage) message).getText());<br>                    } <span class="hljs-keyword">catch</span> (JMSException e) {<br>                        e.printStackTrace();<br>                    }<br>                }<br>            });<br><br>            <span class="hljs-comment">//让主线程休眠100秒，使消息消费者对象能继续存活一段时间从而能监听到消息</span><br>            Thread.sleep(<span class="hljs-number">100</span>  <span class="hljs-number">1000</span>);<br>            <span class="hljs-comment">//关闭资源</span><br>            session.close();<br>            connection.close();<br>        } <span class="hljs-keyword">catch</span> (Exception e) {<br>            e.printStackTrace();<br>        }<br>    }<br>}<br></code></pre><br><p>为了展示主题模式中消息广播给多个订阅者的功能，这里创建了三个消费者对象并订阅了同一个主题，比较特殊的是最后让主线程休眠了一段时间，这么做的目的是让消费者对象能继续存活，从而使控制台能打印出监听到的消息内容。</p><br><h5>启动 ActiveMQ 服务器</h5><br><p>在 ActiveMQ 的 bin 目录下直接执行<code>activemq start</code>即启动了 ActiveMQ</p><br><h5>运行 TopicSubscriber</h5><br><p>需要先运行 TopicSubscriber 类的 main 方法，这样发布者发布消息的时候订阅者才能接收到消息，如果将执行顺序倒过来则消息先发布出去但没有任何订阅者在运行，则看不到消息被消费了。</p><br><h5>运行 TopicPublisher</h5><br><p>接着运行 TopicPublisher 类的 main 方法，向主题中发布3条消息，然后可以在 TopicSubscriber 后台看到接收到的消息内容：</p><br><div class="image-package"><br><div class="image-container" style="max-width: 700px; max-height: 402px; background-color: transparent;"><br><div class="image-container-fill" style="padding-bottom: 49.63%;"></div><br><div class="image-view" data-width="810" data-height="402"><img data-original-src="//upload-images.jianshu.io/upload_images/5015984-bbf01f49ca5d8d4c" data-original-width="810" data-original-height="402" data-original-format="image/png" data-original-filesize="110963" style="cursor: zoom-in;" class="" src="//upload-images.jianshu.io/upload_images/5015984-bbf01f49ca5d8d4c?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></div><br></div><br><div class="image-caption">消费者接收到消息</div><br></div><br><h3>Spring 整合 ActiveMQ</h3><br><p>在实际项目中如果使用原生的 ActiveMQ API 开发显然比较啰嗦，这中间创建连接工厂、创建连接之类代码完全可以抽取出来由框架统一做，这些事情 Spring 也想到了并帮我们做了。ActiveMQ 完全支持基于 Spring 的方式 配置 JMS 客户端和服务器，下面的例子展示一下在 Spring 中如何使用队列模式和主题模式传递消息。</p><br><h5>引入依赖</h5><br><pre class="hljs xml"><code class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.activemq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>activemq-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.15.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jms<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.10.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.activemq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>activemq-pool<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.15.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre><br><p>工程中除了 activemq 的包之外还要添加 Spring 支持 JMS 的包。由于 connection、session、producer 的创建会消耗大量系统资源，为此这里使用 <strong>连接池</strong> 来复用这些资源，所以还要添加 activemq-pool 的依赖。</p><br><h5>Spring 配置文件</h5><br><pre class="hljs xml"><code class="xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">“1.0”</span> encoding=<span class="hljs-string">“UTF-8”</span><span class="hljs-meta">?&gt;</span></span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">“<a href="http://www.springframework.org/schema/beans" target="_blank" rel="noopener">http://www.springframework.org/schema/beans</a>“</span><br>       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">“<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="noopener">http://www.w3.org/2001/XMLSchema-instance</a>“</span><br>       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">“<a href="http://www.springframework.org/schema/context" target="_blank" rel="noopener">http://www.springframework.org/schema/context</a>“</span><br>       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">“<br>        <a href="http://www.springframework.org/schema/beans" target="_blank" rel="noopener">http://www.springframework.org/schema/beans</a><br>        <a href="http://www.springframework.org/schema/beans/spring-beans-3.0.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</a><br>        <a href="http://www.springframework.org/schema/context" target="_blank" rel="noopener">http://www.springframework.org/schema/context</a><br>        <a href="http://www.springframework.org/schema/context/spring-context-3.0.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/context/spring-context-3.0.xsd</a>“</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">“org.study.mq.activeMQ.spring”</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“jmsFactory”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.apache.activemq.pool.PooledConnectionFactory”</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">“stop”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“connectionFactory”</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.apache.activemq.ActiveMQConnectionFactory”</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“brokerURL”</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>tcp://localhost:61616<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“maxConnections”</span> <span class="hljs-attr">value</span>=<span class="hljs-string">“100”</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“cachingConnectionFactory”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.springframework.jms.connection.CachingConnectionFactory”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“targetConnectionFactory”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“jmsFactory”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“sessionCacheSize”</span> <span class="hljs-attr">value</span>=<span class="hljs-string">“1”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“jmsTemplate”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.springframework.jms.core.JmsTemplate”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“connectionFactory”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“cachingConnectionFactory”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“messageConverter”</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.springframework.jms.support.converter.SimpleMessageConverter”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“testQueue”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.apache.activemq.command.ActiveMQQueue”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“name”</span> <span class="hljs-attr">value</span>=<span class="hljs-string">“spring-queue”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“testTopic”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.apache.activemq.command.ActiveMQTopic”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">index</span>=<span class="hljs-string">“0”</span> <span class="hljs-attr">value</span>=<span class="hljs-string">“spring-topic”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“queueListener”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.study.mq.activeMQ.spring.QueueListener”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“topic1Listener”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.study.mq.activeMQ.spring.Topic1Listener”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“topic2Listener”</span> <span class="hljs-attr">class</span>=<span class="hljs-string">“org.study.mq.activeMQ.spring.Topic2Listener”</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“queueContainer”</span><br>          <span class="hljs-attr">class</span>=<span class="hljs-string">“org.springframework.jms.listener.DefaultMessageListenerContainer”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“connectionFactory”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“cachingConnectionFactory”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“destination”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“testQueue”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“messageListener”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“queueListener”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“topic1Container”</span><br>          <span class="hljs-attr">class</span>=<span class="hljs-string">“org.springframework.jms.listener.DefaultMessageListenerContainer”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“connectionFactory”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“cachingConnectionFactory”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“destination”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“testTopic”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“messageListener”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“topic1Listener”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“topic2Container”</span><br>          <span class="hljs-attr">class</span>=<span class="hljs-string">“org.springframework.jms.listener.DefaultMessageListenerContainer”</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“connectionFactory”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“cachingConnectionFactory”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“destination”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“testTopic”</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">“messageListener”</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">“topic2Listener”</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre><br><p>下面的项目示例中的 Java 代码采用注解的方式，这也是现在很多程序员的习惯用法，所以在配置文件一开始定义注解扫描包路径<code>org.study.mq.activeMQ.spring</code>，您可以根据自己实际情况修改包名称，本例中的所有 Java 代码都放在该包之下。</p><br><p>接下来定义了一个 JMS 工厂 bean，采用的是池化连接工厂类<code>org.apache.activemq.pool.PooledConnectionFactory</code>，实际就是对内部的 ActiveMQ 连接工厂增加了连接池的功能，从其内部配置可以看到就是对<code>org.apache.activemq.ActiveMQConnectionFactory</code>的功能封装，而<code>ActiveMQConnectionFactory</code>类则比较熟悉了，就是上面 Java 访问 ActiveMQ 示例一开始创建连接工厂时使用的类。brokerURL 属性配置的就是连接服务器的协议和服务器地址。接下来的 cachingConnectionFactory 是实际项目代码中常用的，对连接工厂的又一层增强，使用连接的缓存功能以提升效率，读者可酌情选择使用。</p><br><p>jmsTemplate 就是 Spring 解决 JMS 访问时冗长重复代码的方案，它需要配置的两个主要属性是 connectionFactory 和 messageConverter，通过 connectionFactory 获取连接、会话等对象，<br><br>messageConverter 则是配置消息转换器，因为通常消息在发送前和接收后都需要进行一个前置和后置处理，转换器便进行这个工作。这样实际代码直接通过 jmsTemplate 来发送和接收消息，而每次发送接收消息时创建连接工厂、创建连接、创建会话等工作都由 Spring 框架做了。</p><br><p>有了 JMS 模板还需要知道队列和主题作为实际发送和接收消息的目的地，所以接下来定义了 testQueue 和 testTopic 作为两种模式的示例。而异步接收消息时则需要提供 MessageListener 的实现类，所以定义了 queueListener 作为队列模式下异步接收消息的监听器，topic1Listener 和 topic2Listener 作为主题模式下异步接收消息的监听器，主题模式用两个监听器是为了演示多个消费者时都能收到消息。最后的 queueContainer、topic1Container、topic2Container 用于将消息监听器绑定到具体的消息目的地上。</p><br><h5>消息服务类</h5><br><p>下面是使用 JMS 模板处理消息的消息服务类</p><br><pre class="hljs java"><code class="java"><span class="hljs-keyword">package</span> org.study.mq.activeMQ.spring;<br><br><span class="hljs-keyword">import</span> org.springframework.jms.core.JmsTemplate;<br><span class="hljs-keyword">import</span> org.springframework.jms.core.MessageCreator;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> javax.jms.*;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageService</span> </span>{<br><br>    <span class="hljs-meta">@Resource</span>(name = <span class="hljs-string">“jmsTemplate”</span>)<br>    <span class="hljs-keyword">private</span> JmsTemplate jmsTemplate;<br><br>    <span class="hljs-meta">@Resource</span>(name = <span class="hljs-string">“testQueue”</span>)<br>    <span class="hljs-keyword">private</span> Destination testQueue;<br><br>    <span class="hljs-meta">@Resource</span>(name = <span class="hljs-string">“testTopic”</span>)<br>    <span class="hljs-keyword">private</span> Destination testTopic;<br><br>    <span class="hljs-comment">//向队列发送消息</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendQueueMessage</span><span class="hljs-params">(String messageContent)</span> </span>{<br>        jmsTemplate.send(testQueue, <span class="hljs-keyword">new</span> MessageCreator() {<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Message <span class="hljs-title">createMessage</span><span class="hljs-params">(Session session)</span> <span class="hljs-keyword">throws</span> JMSException </span>{<br>                TextMessage msg = session.createTextMessage();<br>                <span class="hljs-comment">// 设置消息内容</span><br>                msg.setText(messageContent);<br>                <span class="hljs-keyword">return</span> msg;<br>            }<br>        });<br><br>    }<br><br>    <span class="hljs-comment">//向主题发送消息</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendTopicMessage</span><span class="hljs-params">(String messageContent)</span> </span>{<br>        jmsTemplate.send(testTopic, <span class="hljs-keyword">new</span> MessageCreator() {<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Message <span class="hljs-title">createMessage</span><span class="hljs-params">(Session session)</span> <span class="hljs-keyword">throws</span> JMSException </span>{<br>                TextMessage msg = session.createTextMessage();<br>                <span class="hljs-comment">// 设置消息内容</span><br>                msg.setText(messageContent);<br>                <span class="hljs-keyword">return</span> msg;<br>            }<br>        });<br><br>    }<br>}<br></code></pre><br><p>@Service 将该类声明为一个服务，实际项目中很多服务代码也类似。通过 Resource 注解直接将上面配置文件中定义的 jmsTemplate 引入到 MessageService 类中就可以直接使用了，testQueue 和 testTopic 也是类似，服务类中直接引入配置文件中定义好的队列和主题。重点是下面的两个发送消息的方法，sendQueueMessage 向队列发送消息，sendTopicMessage 向主题发送消息，两种模式都使用了 jmsTemplate 的 send 方法，send 方法第1个参数是<code>javax.jms.Destination</code>类型，表示消息目的地。由于<code>javax.jms.Queue</code>和<code>javax.jms.Topic</code>都继承了<code>javax.jms.Destination</code>接口，所以该方法对队列模式和主题模式都适用。send 方法的第2个参数是<code>org.springframework.jms.core.MessageCreator</code>，这里使用了匿名内部类的方式创建对象，从支持的 Session 对象中创建文本消息，这样就可以发送消息了。可以看到无论是队列还是主题，通过 Spring 框架来发送消息的代码比之前的 Java 代码示例简洁了很多。</p><br><h5>消息监听器类</h5><br><pre class="hljs java"><code class="java"><span class="hljs-keyword">package</span> org.study.mq.activeMQ.spring;<br><br><span class="hljs-keyword">import</span> javax.jms.JMSException;<br><span class="hljs-keyword">import</span> javax.jms.Message;<br><span class="hljs-keyword">import</span> javax.jms.MessageListener;<br><span class="hljs-keyword">import</span> javax.jms.TextMessage;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueueListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MessageListener</span> </span>{<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(Message message)</span> </span>{<br>        <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> TextMessage) {<br>            <span class="hljs-keyword">try</span> {<br>                TextMessage txtMsg = (TextMessage) message;<br>                String messageStr = txtMsg.getText();<br>                System.out.println(<span class="hljs-string">“队列监听器接收到文本消息：”</span> + messageStr);<br>            } <span class="hljs-keyword">catch</span> (JMSException e) {<br>                e.printStackTrace();<br>            }<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">“只支持 TextMessage 类型消息！”</span>);<br>        }<br>    }<br>}<br></code></pre><br><p>队列消息监听器在收到消息时校验是否是文本消息类型，是的话则打印出内容。</p><br><pre class="hljs java"><code class="java"><span class="hljs-keyword">package</span> org.study.mq.activeMQ.spring;<br><br><span class="hljs-keyword">import</span> javax.jms.JMSException;<br><span class="hljs-keyword">import</span> javax.jms.Message;<br><span class="hljs-keyword">import</span> javax.jms.MessageListener;<br><span class="hljs-keyword">import</span> javax.jms.TextMessage;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Topic1Listener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MessageListener</span> </span>{<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(Message message)</span> </span>{<br>        <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> TextMessage) {<br>            <span class="hljs-keyword">try</span> {<br>                TextMessage txtMsg = (TextMessage) message;<br>                String messageStr = txtMsg.getText();<br>                System.out.println(<span class="hljs-string">“主题监听器1 接收到文本消息：”</span> + messageStr);<br>            } <span class="hljs-keyword">catch</span> (JMSException e) {<br>                e.printStackTrace();<br>            }<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">“只支持 TextMessage 类型消息！”</span>);<br>        }<br>    }<br>}<br></code></pre><br><pre class="hljs java"><code class="java"><span class="hljs-keyword">package</span> org.study.mq.activeMQ.spring;<br><br><span class="hljs-keyword">import</span> javax.jms.JMSException;<br><span class="hljs-keyword">import</span> javax.jms.Message;<br><span class="hljs-keyword">import</span> javax.jms.MessageListener;<br><span class="hljs-keyword">import</span> javax.jms.TextMessage;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Topic2Listener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MessageListener</span> </span>{<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(Message message)</span> </span>{<br>        <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> TextMessage) {<br>            <span class="hljs-keyword">try</span> {<br>                TextMessage txtMsg = (TextMessage) message;<br>                String messageStr = txtMsg.getText();<br>                System.out.println(<span class="hljs-string">“主题监听器2 接收到文本消息：”</span> + messageStr);<br>            } <span class="hljs-keyword">catch</span> (JMSException e) {<br>                e.printStackTrace();<br>            }<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">“只支持 TextMessage 类型消息！”</span>);<br>        }<br>    }<br>}<br></code></pre><br><p>主题监听器的代码与队列监听器类似，只是打印时通过不同字符串表示当前是不同监听器接收的消息。</p><br><h5>启动应用</h5><br><p>为了演示例子，写了一个 StartApplication 类，在 main 方法中加载 Spring ，获取到 MessageService 服务之后调用 sendQueueMessage 和 sendTopicMessage 方法发送消息。</p><br><pre class="hljs java"><code class="java"><span class="hljs-keyword">package</span> org.study.mq.activeMQ.spring;<br><br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StartApplication</span> </span>{<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        ApplicationContext ctx = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">“spring-context.xml”</span>);<br>        MessageService messageService = (MessageService) ctx.getBean(<span class="hljs-string">“messageService”</span>);<br><br>        messageService.sendQueueMessage(<span class="hljs-string">“我的测试消息1”</span>);<br>        messageService.sendTopicMessage(<span class="hljs-string">“我的测试消息2”</span>);<br>        messageService.sendTopicMessage(<span class="hljs-string">“我的测试消息3”</span>);<br>    }<br><br>}<br></code></pre><br><p>启动好 activeMQ 服务之后运行 StartApplication 类，在控制台看到接收到文本消息：</p><br><div class="image-package"><br><div class="image-container" style="max-width: 700px; max-height: 302px; background-color: transparent;"><br><div class="image-container-fill" style="padding-bottom: 35.870000000000005%;"></div><br><div class="image-view" data-width="842" data-height="302"><img data-original-src="//upload-images.jianshu.io/upload_images/5015984-5ed76cf546927df2" data-original-width="842" data-original-height="302" data-original-format="image/png" data-original-filesize="108270" style="cursor: zoom-in;" class="" src="//upload-images.jianshu.io/upload_images/5015984-5ed76cf546927df2?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></div><br></div><br><div class="image-caption">接收到文本消息</div><br></div><br><p>队列监听器监听到了一条消息，两个主题监听器分别监听到了两条消息。</p>



      
    </div>
    
    
    
	
	<div>
  
    ﻿<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
	</div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ActiveMQ/" rel="tag"><i class="fa fa-tag"></i> ActiveMQ</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/12/17/struts2/" rel="next" title="Struts2">
                <i class="fa fa-chevron-left"></i> Struts2
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        ﻿<!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="吴金龙" />
            
              <p class="site-author-name" itemprop="name">吴金龙</p>
              <p class="site-description motion-element" itemprop="description">Day Day Up,Good Dood Study.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/wjlfun" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:findmorelove@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
			<div id="music163player">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=549420832&auto=1&height=66"></iframe>
</div>
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">ActiveMQ 特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.1.</span> <span class="nav-text">消息传送模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.2.</span> <span class="nav-text">基本组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.3.</span> <span class="nav-text">连接器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.4.</span> <span class="nav-text">消息存储</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number"></span> <span class="nav-text">工程实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">Java 访问 ActiveMQ 实例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">1.0.1.</span> <span class="nav-text">引入依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">1.0.2.</span> <span class="nav-text">消息生产者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">1.0.3.</span> <span class="nav-text">消息消费者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">1.0.4.</span> <span class="nav-text">启动 ActiveMQ 服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">1.0.5.</span> <span class="nav-text">运行 TopicSubscriber</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">1.0.6.</span> <span class="nav-text">运行 TopicPublisher</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">Spring 整合 ActiveMQ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.1.</span> <span class="nav-text">引入依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.2.</span> <span class="nav-text">Spring 配置文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.3.</span> <span class="nav-text">消息服务类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.4.</span> <span class="nav-text">消息监听器类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#undefined"><span class="nav-number">2.0.5.</span> <span class="nav-text">启动应用</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
			 </div>
	
	
	
      <!--/noindex-->
      

      
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        ﻿<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吴金龙</span>

  
</div>


	<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span><i class="fa fa-eye-md"></i><span id="busuanzi_container_site_pv">
    <span id="busuanzi_value_site_pv"></span>次
</span>
</span>

 <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共11.2k字</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">本站访客数</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      3563
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">本站总访问量</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      5497
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  ﻿


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  ﻿<script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  ﻿


  




	





  





  












  





  

  

  

  
  

  

  

  

  
   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/src/fireworks.js"></script>

</body>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</html>
